<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Docker Container | Jiekun Zhang&#39;s blog</title>
  <meta name="author" content="Jiekun Zhang">
  
  <meta name="description" content="1. 常用命令
docker run [username]/app:verison CMD
docker ps -a / docker container ls -a
docker stop containerID
docker rm containerID
docker rmi ImageID
d">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Docker Container"/>
  <meta property="og:site_name" content="Jiekun Zhang&#39;s blog"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70812759-1', 'auto');
  ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?cb5448498d7169c668b07c2b255d62c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Jiekun Zhang&#39;s blog</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> Docker Container</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h2 id="1-常用命令"><a href="#1-常用命令" class="headerlink" title="1. 常用命令"></a>1. 常用命令</h2><ul>
<li>docker run [username]/app:verison CMD</li>
<li>docker ps -a / docker container ls -a</li>
<li>docker stop containerID</li>
<li>docker rm containerID</li>
<li>docker rmi ImageID</li>
<li>docker run … –name tagName</li>
<li>docker start／stop</li>
<li>docker run -it –restart=always xxxx</li>
<li>docker pause/unpause</li>
</ul>
<h2 id="2-如何让容器保存运行呢？"><a href="#2-如何让容器保存运行呢？" class="headerlink" title="2. 如何让容器保存运行呢？"></a>2. 如何让容器保存运行呢？</h2><p>因为容器的生命周期依赖于启动时执行的命令，只要该命令不结束，容器也就不会退出。</p>
<ol>
<li>写个while True 命令让程序持续运行 即可</li>
<li>docker run –restart=always</li>
</ol>
<h2 id="3-两种进入容器的方法"><a href="#3-两种进入容器的方法" class="headerlink" title="3. 两种进入容器的方法"></a>3. 两种进入容器的方法</h2><p>docker attach: 用于查看docker输出结果，不可以执行命令<br>docker exec:  是在容器中打开新的终端，并且可以启动新的进程。</p>
<ul>
<li>docker exec -it <container> bash|sh 是执行 exec 最常用的方式。</container></li>
</ul>
<p>结论：如果想直接在终端中查看启动命令的输出，用 attach；其他情况使用 exec。</p>
<ul>
<li>当然，如果只是为了查看启动命令的输出，可以使用 docker logs 命令：docker log -f containID<blockquote>
<p>参考：<a href="http://www.cnblogs.com/CloudMan6/p/6928772.html" target="_blank" rel="noopener">http://www.cnblogs.com/CloudMan6/p/6928772.html</a></p>
</blockquote>
</li>
</ul>
<h2 id="4-容器分类"><a href="#4-容器分类" class="headerlink" title="4. 容器分类"></a>4. 容器分类</h2><ul>
<li><p>服务类的容器。</p>
</li>
<li><p>工具类的容器。</p>
</li>
</ul>
<ol>
<li><p>服务类容器以 daemon 的形式运行，对外提供服务。比如 web server，数据库等。通过 -d 以后台方式启动这类容器是非常合适的。如果要排查问题，可以通过 exec -it 进入容器。</p>
</li>
<li><p>工具类容器通常给能我们提供一个临时的工作环境，通常以 run -it 方式运行</p>
</li>
</ol>
<h2 id="5-容器生命周期"><a href="#5-容器生命周期" class="headerlink" title="5.容器生命周期"></a>5.容器生命周期</h2><p><img src="http://7xo6kd.com1.z0.glb.clouddn.com/upload-ueditor-image-20170608-1496889671778038814.jpg" alt="容器生命周期" title="123"></p>
<h2 id="6-限制容器对内存的使用（定额）"><a href="#6-限制容器对内存的使用（定额）" class="headerlink" title="6.限制容器对内存的使用（定额）"></a>6.限制容器对内存的使用（定额）</h2><ol>
<li>内存限制</li>
</ol>
<ul>
<li>docker run -m 200M –memory-swap=300M ubuntu<br>（-m ：物理内存，–memory-swap:虚拟内存）<blockquote>
<p>下面我们将使用 progrium/stress 镜像来学习如何为容器分配内存。该镜像可用于对容器执行压力测试。执行如下命令：<br>docker run -it -m 200M –memory-swap=300M progrium/stress –vm 1 –vm-bytes 280M<br>–vm 1：启动 1 个内存工作线程。<br>–vm-bytes 280M：每个线程分配 280M 内存。<br>因为 280M 在可分配的范围（300M）内，所以工作线程能够正常工作，<br>如果让工作线程分配的内存超过 300M,分配的内存超过限额，stress 线程报错，容器退出</p>
</blockquote>
</li>
</ul>
<p>如果在启动容器时只指定 -m 而不指定 –memory-swap，那么 –memory-swap 默认为 -m 的两倍</p>
<h2 id="7-限制容器对CPU的使用（成比例）"><a href="#7-限制容器对CPU的使用（成比例）" class="headerlink" title="7. 限制容器对CPU的使用（成比例）"></a>7. 限制容器对CPU的使用（成比例）</h2><blockquote>
<p>Docker 可以通过 -c 或 –cpu-shares 设置容器使用 CPU 的权重。如果不指定，默认值为 1024。</p>
</blockquote>
<p>与内存限额不同，通过 -c 设置的 cpu share 并不是 CPU 资源的绝对数量，而是一个相对的权重值。某个容器最终能分配到的 CPU 资源取决于它的 cpu share 占所有容器 cpu share 总和的比例。</p>
<p>换句话说：通过 cpu share 可以设置容器使用 CPU 的优先级。</p>
<h2 id="8-限制容器对-Block-IO-带宽资源的使用"><a href="#8-限制容器对-Block-IO-带宽资源的使用" class="headerlink" title="8. 限制容器对 Block IO 带宽资源的使用"></a>8. 限制容器对 Block IO 带宽资源的使用</h2><blockquote>
<p>默认情况下，所有容器能平等地读写磁盘，可以通过设置 –blkio-weight 参数来改变容器 block IO 的优先级。</p>
</blockquote>
<p>–blkio-weight 与 –cpu-shares 类似，设置的是相对权重值，默认为 500。在下面的例子中，container_A 读写磁盘的带宽是 container_B 的两倍。</p>
<blockquote>
<p>参考 <a href="http://www.cnblogs.com/CloudMan6/p/7016050.html" target="_blank" rel="noopener">http://www.cnblogs.com/CloudMan6/p/7016050.html</a></p>
</blockquote>
<h2 id="9-容器底层技术"><a href="#9-容器底层技术" class="headerlink" title="9. 容器底层技术"></a>9. 容器底层技术</h2><blockquote>
<p>cgroup 和 namespace 是最重要的两种技术。<br>cgroup 实现资源限额， namespace 实现资源隔离</p>
</blockquote>
<ol>
<li><p>cgroup<br>cgroup 全称 Control Group。Linux 操作系统通过 cgroup 可以设置进程使用 CPU、内存 和 IO 资源的限额。<br>前面我们看到的–cpu-shares、-m、–device-write-bps 实际上就是在配置 cgroup。</p>
<blockquote>
<p>cgroup 到底长什么样子呢？我们可以在 /sys/fs/cgroup 中找到它。</p>
<ul>
<li>在 /sys/fs/cgroup/cpu/docker 目录中，Linux 会为每个容器创建一个 cgroup 目录，以容器长ID 命名。<br>目录中包含所有与 cpu 相关的 cgroup 配置，文件 cpu.shares 保存的就是 –cpu-shares 的配置，值为 512。</li>
</ul>
</blockquote>
<blockquote>
<p>同样的，<br>/sys/fs/cgroup/memory/docker     –内存<br>/sys/fs/cgroup/blkio/docker      –Block IO<br>保存的是内存以及 Block IO 的 cgroup 配置。</p>
</blockquote>
</li>
<li><p>namespace<br>namespace 实现了容器间资源的隔离( 文件系统，网卡等资源 )</p>
<blockquote>
<p>Linux 使用了六种 namespace，分别对应六种资源：<br>Mount、UTS、IPC、PID、Network 和 User，下面我们分别讨论。</p>
<ul>
<li>Mount namespace<br>Mount namespace 让容器看上去拥有整个文件系统。<br>容器有自己的 / 目录，可以执行 mount 和 umount 命令。当然我们知道这些操作只在当前容器中生效，不会影响到 host 和其他容器。</li>
<li>UTS namespace<br>简单的说，UTS namespace 让容器有自己的 hostname。 默认情况下，容器的 hostname 是它的短ID，可以通过 -h 或 –hostname 参数设置。</li>
<li>IPC namespace<br>IPC namespace 让容器拥有自己的共享内存和信号量（semaphore）来实现进程间通信，而不会与 host 和其他容器的 IPC 混在一起。</li>
<li>PID namespace<br>容器拥有自己独立的一套 PID，这就是 PID namespace 提供的功能。</li>
<li>Network namespace<br>Network namespace 让容器拥有自己独立的网卡、IP、路由等资源</li>
<li>User namespace<br>User namespace 让容器能够管理自己的用户，host 不能看到容器中创建的用户。</li>
</ul>
</blockquote>
</li>
</ol>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a type="button" class="btn btn-default disabled"><i class="fa fa-arrow-circle-o-left"></i>Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2018/05/28/docker-Image/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2018-05-28 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/Study/">Study<span>4</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/Docker/">Docker<span>4</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2018 Jiekun Zhang
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind.386</a>.    
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
